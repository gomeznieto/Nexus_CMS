@model PostViewModel
@using System.Text.Json;

@{
    ViewData["Title"] = "Crear post";
}

<div class="mt-5">
    <h1>Crear @Model.format</h1>
    <fs-4>El texto debe ser escrito con markdown para poder colocar estilos.</fs-4>

    <form asp-action="Crear" method="post" class="mt-5">

        <!-- VALIDATION -->
        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

        <!-- HIDDEN -->
        <input type="hidden" asp-for="user_id" />
        <input type="hidden" asp-for="format_id" />
        <input type="hidden" asp-for="format" />
        <input type="hidden" asp-for="draft" id="inputDraft" />
        <input type="hidden" asp-for="mediaListString" id="imageLinksField" />
        <input type="hidden" asp-for="sourceListString" id="sourceLinksField" />
        <input type="hidden" asp-for="categoryListString" id="categoryListField" />

        <!-- CREACION DE ENTRADA -->
        <div class="mb-3">
            <input asp-for="title" class="form-control fs-2 fw-bolder" placeholder="Agregar titulo"/>
            <span asp-validation-for="title" class="form-error"></span>
        </div>

         <!-- POST -->
        <div class="mb-3">
            <!-- STYLES -->
            <partial name="_TextControl" />

            <!-- TEXT -->
            <textarea asp-for="description" class="form-control textarea-style" rows="10" placeholder="Agregar contenido de la entrada" id="post_text"></textarea>
            <span asp-validation-for="description" class="form-error"></span>
        </div>

        <div class="mb-3">
            <input asp-for="cover" class="form-control" placeholder="Agregar la imagen principal para ilustracion"/>
            <span asp-validation-for="cover" class="form-error"></span>
        </div>

        <!-- AGREGAR CATEGORIAS -->
        <div class="mb-3">
            <h3 class="fs-5">Categorias</h3>
            <select class="form-select select-style" id="selectCategory" postId="@Model.id" onchange="addCategory(this)">
                <option disabled selected>Seleccione categorías</option>
                @foreach (var category in Model.categories)
                {
                    <option value="@category.Value">@category.Text</option>
                }
            </select>

            <div class="mb-3 d-flex" id="categoryContainer"></div>
        </div>

        <!-- AGREGAR MULTIMEDIA -->
        <div class="mb-3">
            <h3 class="fs-5">Multi Media</h3>
            <button type="button" class="btn btn-add mb-3" onclick="addInputMedia()">Agregar Multimedia</button>
            <div id="inputContainerMedia">
            </div>
        </div>

        <!--LINKS-->
        <div class="mb-3">
            <h3 class="fs-5">Links</h3>
            <button type="button" class="btn btn-add mb-3" onclick="addInputLink()">Agregar Link</button>
            <div id="inputContainerLinks">
            </div>
        </div>

        <!-- BUTTON -->
        <button type="submit" class="btn btn-action" onclick="enviarDatosAlServidor()">Publicar</button>
        <button type="submit" class="btn btn-borrador" onclick="Borrador(); enviarDatosAlServidor();">Borrador</button>
        <a asp-action="Index" asp-route-format="@Model.format" class="btn btn-delete"><i class="fa-solid fa-arrow-rotate-left"></i> Regresar</a>
    </form>

</div>

@section Scripts
{
	<partial name="_ValidationScriptsPartial" />

    <script>
  
        //Agregar una multi media más
        function addInputMedia() {
            //Agregamos elemento nuevo para agragar nuevo medias
            var container = document.getElementById('inputContainerMedia');
            var div = document.createElement('div');
            div.className = 'input-group';

            // Creamos el select
            var select = document.createElement('select');
            select.className = 'form-select mb-3 select-style w-25';

            // Agregamos opciones al select utilizando los SelectListItem del modelo
            @foreach (var item in Model.mediaTypes)
            {
                <text>
                    var option = document.createElement("option");
                    option.text = "@item.Text";
                    option.value = "@item.Value";
                    select.add(option);
                </text>
            }
                // Agregamos el select al div
                div.appendChild(select);

            // Creamos el input
            var input = document.createElement('input');
            input.className = 'form-control mb-3 imgList imgAdd input-style w-50';
            input.placeholder = 'Ingrese link multimedia';
            // Agregamos el input al div
            div.appendChild(input);

            // Creamos los botones
            var addButton = document.createElement('button');
            addButton.type = 'button';
            addButton.className = 'btn btn-action ms-2 h-50';
            addButton.textContent = 'Agregar';
            addButton.onclick = function () { addList(this, "post"); };
            // Agregamos el botón al div
            div.appendChild(addButton);

            var removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.className = 'btn btn-delete ms-2 h-50';
            removeButton.textContent = 'Eliminar';
            removeButton.onclick = function () { removeInput(this, "post"); };
            // Agregamos el botón al div
            div.appendChild(removeButton);

            // Agregamos el div al contenedor
            container.appendChild(div);
        }

        //Agregat una fuente nueva
        function addInputLink() {
            //Agregamos elemento nuevo para agragar nuevo medias
            var container = document.getElementById('inputContainerLinks');
            var div = document.createElement('div');
            div.className = 'input-group';

            // Creamos el select
            var select = document.createElement('select');
            select.className = 'form-select mb-3 select-style w-25';

            // Agregamos opciones al select utilizando los SelectListItem del modelo
        @foreach (var item in Model.sources)
        {
            <text>
                var option = document.createElement("option");
                option.text = "@item.Text";
                option.value = "@item.Value";
                select.add(option);
            </text>
        }
                // Agregamos el select al div
                div.appendChild(select);

            // Creamos el input
            var input = document.createElement('input');
            input.className = 'form-control mb-3 imgList imgAdd input-style w-50';
            input.placeholder = 'Ingrese link de la fuente';
            // Agregamos el input al div
            div.appendChild(input);

            // Creamos los botones
            var addButton = document.createElement('button');
            addButton.type = 'button';
            addButton.className = 'btn btn-action ms-2 h-50';
            addButton.textContent = 'Agregar';
            addButton.onclick = function () { addList(this, "source"); };
            // Agregamos el botón al div
            div.appendChild(addButton);

            var removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.className = 'btn btn-delete ms-2 h-50';
            removeButton.textContent = 'Eliminar';
            removeButton.onclick = function () { removeInput(this, "source"); };
            // Agregamos el botón al div
            div.appendChild(removeButton);

            // Agregamos el div al contenedor
            container.appendChild(div);
        }

    </script>
}