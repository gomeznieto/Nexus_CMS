@model UserViewModel

@{
    ViewData["Title"] = "Apikey";
}

<h3>Apikeys</h3>
<div class="d-flex p-1 row gap-3">
    <div class="mt-3 col-8">
        <div class="input-group input-group-sm flex-nowrap">
            <input type="password" id="apikey" asp-for=@Model.apiKey class="form-control input-style" value="@Model.apiKey" />
            <i class="fa-regular fa-eye input-group-text d-flex align-items-center" id="toggleApikey"></i>
            <i class="fa-solid fa-pen input-group-text d-flex align-items-center" id="copyApikey"></i>
        </div>
        <form asp-action="Apikey" asp-controller="Users" method="post" id="resetApiKeyForm">
            <button type="button" class="btn btn-action mt-3" id="btnResetApikey">Restablecer ApiKey</button>
        </form>
    </div>
</div>
<div id="snackbar">¡Se ha copiado la ApiKey en el portapapeles!</div>

<div class="modal fade" id="confirmResetModal" tabindex="-1" aria-labelledby="confirmResetModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bgModalConfirm">
            <div class="d-flex justify-content-center align-content-center">
                <h5 class="modal-title" id="confirmResetModalLabel">Reestablecer ApiKey</h5>
            </div>
            <div class="mt-4 text-center fw-normal">
                ¿Estás seguro de que deseas restablecer la ApiKey?
            </div>
            <div class="d-flex justify-content-between align-content-center mt-4">
                <button type="button" class="btn btn-delete" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-edit" id="confirmResetBtn">Restablecer</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}


<script>
    function toogleIconEye(element, type)
    {

         if(type == "password")
        {
            element.classList.add("fa-eye");
            element.classList.remove("fa-eye-slash")
        }
        else
        {
            element.classList.add("fa-eye-slash")
            element.classList.remove("fa-eye")
        }
    }

    function toogleIconPen()
    {
        let icon = document.getElementById('copyApikey');
        icon.classList.add("fa-check")
        icon.classList.add("icon-check")
        icon.classList.remove("fa-pen")

        setTimeout(() => {
         icon.classList.remove("fa-check")
        icon.classList.remove("icon-check")
        icon.classList.add("fa-pen")
        }, 3000)

    }

    document.getElementById('toggleApikey').addEventListener('click', function () {
        const apiInput = document.getElementById('apikey');
        const type = apiInput.getAttribute('type') === 'password' ? 'text' : 'password';
        apiInput.setAttribute('type', type);

        toogleIconEye(this, type)
    });

    document.getElementById('copyApikey').addEventListener('click', () => {
        const apiInput = document.getElementById('apikey');
        apiInput.select();
        apiInput.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(apiInput.value);

        toogleIconPen()
        openToast()

    })

        document.addEventListener('DOMContentLoaded', function () {
        const btnResetApikey = document.getElementById('btnResetApikey');
        const confirmResetModal = new bootstrap.Modal(document.getElementById('confirmResetModal'));
        const confirmResetBtn = document.getElementById('confirmResetBtn');
        const resetApiKeyForm = document.getElementById('resetApiKeyForm');

        // Cuando se hace clic en el botón "Restablecer ApiKey"
        btnResetApikey.addEventListener('click', function () {
            confirmResetModal.show(); // Muestra el modal de confirmación
        });

        // Cuando se hace clic en el botón "Restablecer" dentro del modal
        confirmResetBtn.addEventListener('click', function () {
            confirmResetModal.hide(); // Oculta el modal
            resetApiKeyForm.submit(); // Envía el formulario programáticamente
        });
    });

</script>